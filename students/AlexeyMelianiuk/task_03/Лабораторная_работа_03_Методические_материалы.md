# Лабораторная работа 03 — Методические материалы

В этом файле: как получить данные с публичного API, отрисовать таблицу, добавить пагинацию и кеширование в localStorage, и оформить отчёт. Команды даны для PowerShell на Windows.

1. Старт (подготовка структуры)
- Создайте рабочую папку проекта (например, students/<id>/task_03/src).
- Подготовьте файлы: index.html, index.js, styles.css.
- Базовая разметка index.html (контейнеры для статусов/таблицы/пагинации):
  
	<!DOCTYPE html>
	<html lang="ru">
		<head>
			<meta charset="UTF-8" />
			<meta name="viewport" content="width=device-width, initial-scale=1.0" />
			<title>ЛР03 — Таблица с API</title>
			<link rel="stylesheet" href="styles.css" />
		</head>
		<body>
			<main>
				<h1>Данные из API</h1>
				<div id="status" aria-live="polite"></div>
				<table>
					<thead>
						<tr>
							<th>ID</th>
							<th>Название</th>
							<th>Описание</th>
						</tr>
					</thead>
					<tbody id="table-body"></tbody>
				</table>
				<nav aria-label="Пагинация" class="pager">
					<button id="prev" disabled>Назад</button>
					<span id="page-info">Стр. 1/1</span>
					<button id="next" disabled>Вперёд</button>
				</nav>
			</main>
			<script src="index.js" type="module"></script>
		</body>
	</html>
  
- Минимальные стили styles.css:
  
	body { font-family: system-ui, sans-serif; margin: 16px; }
	table { border-collapse: collapse; width: 100%; margin: 12px 0; }
	th, td { border: 1px solid #ddd; padding: 8px; }
	th { background: #f5f5f5; text-align: left; }
	.pager { display: flex; gap: 8px; align-items: center; }
	#status { margin: 8px 0; color: #444; }

2. Получение данных (fetch + async/await)
- Выберите публичное API (для примера возьмём https://jsonplaceholder.typicode.com/posts).
- Шаблон index.js для загрузки данных и информирования о статусе:
  
	const API_URL = 'https://jsonplaceholder.typicode.com/posts';
	const CACHE_KEY = 'lr03_cache_posts';
	const CACHE_TTL_MS = 5 * 60 * 1000; // 5 минут
  
	const statusEl = document.getElementById('status');
	const tbody = document.getElementById('table-body');
	const prevBtn = document.getElementById('prev');
	const nextBtn = document.getElementById('next');
	const pageInfo = document.getElementById('page-info');
  
	const state = { data: [], page: 1, pageSize: 10 };
  
	function setStatus(text) { statusEl.textContent = text; }
	function setError(text) { statusEl.textContent = text; statusEl.style.color = 'crimson'; }
  
	async function fetchFromApi() {
		setStatus('Загрузка по сети...');
		const res = await fetch(API_URL);
		if (!res.ok) throw new Error('Ошибка сети: ' + res.status);
		const data = await res.json();
		return data;
	}
  
	function readCache() {
		const raw = localStorage.getItem(CACHE_KEY);
		if (!raw) return null;
		try {
			const parsed = JSON.parse(raw);
			if (!parsed || !Array.isArray(parsed.data)) return null;
			if (Date.now() - parsed.cachedAt > CACHE_TTL_MS) return null;
			return parsed.data;
		} catch { return null; }
	}
  
	function writeCache(items) {
		localStorage.setItem(CACHE_KEY, JSON.stringify({ data: items, cachedAt: Date.now() }));
	}

3. Кэширование
- При старте сначала пробуйте прочитать локальный кэш. Если нет или просрочен — идите в сеть и после успешной загрузки обновите кэш.
- Добавьте функцию инициализации и отрисовки таблицы с пагинацией:
  
	function renderPage() {
		const start = (state.page - 1) * state.pageSize;
		const pageItems = state.data.slice(start, start + state.pageSize);
		tbody.innerHTML = pageItems.map(p => `
			<tr>
				<td>${p.id}</td>
				<td>${p.title}</td>
				<td>${p.body}</td>
			</tr>
		`).join('');
		const totalPages = Math.max(1, Math.ceil(state.data.length / state.pageSize));
		pageInfo.textContent = `Стр. ${state.page}/${totalPages}`;
		prevBtn.disabled = state.page <= 1;
		nextBtn.disabled = state.page >= totalPages;
	}
  
	async function init() {
		try {
			let items = readCache();
			if (items) {
				setStatus('Загружено из кэша (до 5 мин)');
			} else {
				items = await fetchFromApi();
				writeCache(items);
				setStatus('Загружено по сети и закэшировано');
			}
			state.data = items;
			renderPage();
		} catch (e) {
			setError('Не удалось загрузить данные: ' + (e?.message ?? e));
		}
	}
  
	prevBtn.addEventListener('click', () => { state.page--; renderPage(); });
	nextBtn.addEventListener('click', () => { state.page++; renderPage(); });
  
	init();
  
- Очистка кэша (опционально):
  
	function clearCache() { localStorage.removeItem(CACHE_KEY); setStatus('Кэш очищен'); }

4. Пагинация
- Логика в примере выше: вычисляйте индексы среза данных; блокируйте кнопки на краях; обновляйте счётчик.

5. UX
- Добавьте индикатор загрузки (текст/иконка) до появления данных; показывайте понятные сообщения об ошибках; явно указывайте источник (кэш или сеть).

6. Запуск локально
- Откройте папку с файлами в VS Code и используйте расширение Live Server, либо запустите простой http-сервер (например, установка глобально `npm i -g http-server`, запуск `http-server .` из папки src).
- Откройте в браузере http://localhost:8080 или указанный порт и проверьте работу.

7. Отчёт
- В `students/<id>/task_03/doc/readme.md`: ссылка на использованный API, скриншоты таблицы/пагинации, пояснение логики кэша, что хранится в localStorage и TTL.
