# Лабораторная работа 05 — Методические материалы

Темы: слои/DI, ASP.NET Core Identity, загрузка/скачивание файлов.

1. Структура слоёв
- Создайте решение и проекты:
	- `dotnet new sln -n Task05`
	- `dotnet new classlib -n Task05.Domain`
	- `dotnet new classlib -n Task05.Application`
	- `dotnet new classlib -n Task05.Infrastructure`
	- `dotnet new web -n Task05.Web`
	- `dotnet sln Task05.sln add Task05.*`
- Ссылки между проектами: Web -> Application -> Domain; Web -> Infrastructure; Application -> Domain; Infrastructure -> Application/Domain (минимально необходимое).
- Пример `IClock`:
	- interface IClock { DateTime UtcNow { get; } }
	- class SystemClock : IClock { public DateTime UtcNow => DateTime.UtcNow; }
	- Регистрация: builder.Services.AddSingleton<IClock, SystemClock>();

2. Identity
- В Web-проекте добавьте пакеты (при необходимости): Microsoft.AspNetCore.Identity.EntityFrameworkCore, Microsoft.EntityFrameworkCore.Sqlite (или SqlServer), Tools.
- Настройте DbContext для Identity, подключите SQLite/SQL Server через ConnectionString из appsettings.json.
- Выполните миграции: `dotnet ef migrations add InitIdentity`; `dotnet ef database update`.
- Реализуйте регистрация/логин/выход по шаблону Identity UI или своими страницами.
- Создайте роль Admin при старте (IHostedService/Scoped инициализатор) и потребуйте роль на маршруте `[Authorize(Roles = "Admin")]`.

3. Файлы
- Настройте ограничение размера через RequestSizeLimit и проверяйте ContentType/расширение.
- Сохраняйте файлы в папку `wwwroot/uploads` с генерацией безопасного имени (Guid + расширение), не используйте исходное имя без проверки.
- Для скачивания возвращайте File() с правильным content-disposition и content-type.

4. Отчёт
- В `students/<id>/task_05/doc/readme.md`: схема слоёв, сценарии ролей, скриншоты загрузки/скачивания.

5. Запуск
- `dotnet run --project Task05.Web`
